<div class="container">
  <h1 class="form-title">Registro de Especialista</h1>
  
  <form [formGroup]="registroForm" (ngSubmit)="registrar()">
    <!-- Correo -->
    <div class="form-group">
      <label for="correo">Correo Electr√≥nico:</label>
      <input id="correo" formControlName="correo" type="email" class="form-control" 
             placeholder="ejemplo@correo.com" />
      <div *ngIf="f['correo'].touched && f['correo'].invalid" class="error-container">
        <small *ngIf="f['correo'].errors?.['required']">El correo es obligatorio.</small>
        <small *ngIf="f['correo'].errors?.['email']">El correo no es v√°lido.</small>
      </div>
    </div>

    <!-- Contrase√±a -->
    <div class="form-group">
      <label for="contrase√±a">Contrase√±a:</label>
      <input id="contrase√±a" formControlName="contrase√±a" type="password" class="form-control" 
             placeholder="M√≠nimo 6 caracteres, una may√∫scula y un n√∫mero" />
      <div *ngIf="f['contrase√±a'].touched && f['contrase√±a'].invalid" class="error-container">
        <small *ngIf="f['contrase√±a'].errors?.['required']">La contrase√±a es obligatoria.</small>
        <small *ngIf="f['contrase√±a'].errors?.['minlength']">La contrase√±a debe tener al menos 6 caracteres.</small>
        <small *ngIf="f['contrase√±a'].errors?.['pattern']">La contrase√±a debe tener al menos una letra may√∫scula y un n√∫mero.</small>
      </div>
    </div>

    <!-- Confirmar Contrase√±a -->
    <div class="form-group">
      <label for="confirmarContrase√±a">Confirmar Contrase√±a:</label>
      <input id="confirmarContrase√±a" formControlName="confirmarContrase√±a" type="password" class="form-control" 
             placeholder="Repite tu contrase√±a" />
      <div *ngIf="f['confirmarContrase√±a'].touched && f['confirmarContrase√±a'].invalid" class="error-container">
        <small *ngIf="f['confirmarContrase√±a'].errors?.['required']">La confirmaci√≥n de la contrase√±a es obligatoria.</small>
        <small *ngIf="f['confirmarContrase√±a'].errors?.['noMatch']">Las contrase√±as no coinciden.</small>
      </div>
    </div>

    <!-- Nombre -->
    <div class="form-group">
      <label for="nombre">Nombre:</label>
      <input id="nombre" formControlName="nombre" type="text" class="form-control" 
             placeholder="Tu nombre" />
      <div *ngIf="f['nombre'].touched && f['nombre'].invalid" class="error-container">
        <small *ngIf="f['nombre'].errors?.['required']">El nombre es obligatorio.</small>
        <small *ngIf="f['nombre'].errors?.['minlength']">El nombre debe tener al menos 2 caracteres.</small>
      </div>
    </div>

    <!-- Apellido -->
    <div class="form-group">
      <label for="apellido">Apellido:</label>
      <input id="apellido" formControlName="apellido" type="text" class="form-control" 
             placeholder="Tu apellido" />
      <div *ngIf="f['apellido'].touched && f['apellido'].invalid" class="error-container">
        <small *ngIf="f['apellido'].errors?.['required']">El apellido es obligatorio.</small>
        <small *ngIf="f['apellido'].errors?.['minlength']">El apellido debe tener al menos 2 caracteres.</small>
      </div>
    </div>

    <!-- Edad -->
    <div class="form-group">
      <label for="edad">Edad:</label>
      <input id="edad" formControlName="edad" type="number" class="form-control" 
             placeholder="Tu edad" min="18" max="120" />
      <div *ngIf="f['edad'].touched && f['edad'].invalid" class="error-container">
        <small *ngIf="f['edad'].errors?.['required']">La edad es obligatoria.</small>
        <small *ngIf="f['edad'].errors?.['min']">Debes tener al menos 18 a√±os.</small>
      </div>
    </div>

    <!-- DNI -->
    <div class="form-group">
      <label for="dni">DNI:</label>
      <input id="dni" formControlName="dni" type="text" class="form-control" 
             placeholder="12345678" maxlength="8" />
      <div *ngIf="f['dni'].touched && f['dni'].invalid" class="error-container">
        <small *ngIf="f['dni'].errors?.['required']">El DNI es obligatorio.</small>
        <small *ngIf="f['dni'].errors?.['pattern']">El DNI debe tener entre 7 y 8 d√≠gitos.</small>
      </div>
    </div>

    <!-- Especialidades -->
    <div class="form-group">
      <label>Especialidades:</label>
      
      <!-- Especialidades predefinidas -->
      <div class="especialidades-predefinidas">
        <div *ngFor="let especialidad of especialidadesPredefinidas" class="especialidad-checkbox">
          <input type="checkbox" 
                 [id]="'esp-' + especialidad" 
                 [value]="especialidad"
                 (change)="onEspecialidadChange($event)" />
          <label [for]="'esp-' + especialidad">{{ especialidad }}</label>
        </div>
      </div>

      <!-- Campo para agregar especialidad personalizada -->
      <div class="especialidad-personalizada">
        <input type="text" 
               placeholder="Agregar otra especialidad" 
               class="form-control"
               [(ngModel)]="nuevaEspecialidad"
               [ngModelOptions]="{standalone: true}" />
        <button type="button" 
                class="btn btn-secondary"
                (click)="agregarEspecialidadPersonalizada()"
                [disabled]="!nuevaEspecialidad.trim()">
          Agregar
        </button>
      </div>

      <!-- Especialidades seleccionadas -->
      <div *ngIf="especialidadesSeleccionadas.length > 0" class="especialidades-seleccionadas">
        <h4>Especialidades seleccionadas:</h4>
        <div class="especialidad-tag" *ngFor="let esp of especialidadesSeleccionadas">
          {{ esp }}
          <button type="button" class="remove-especialidad" (click)="removerEspecialidad(esp)">‚úï</button>
        </div>
      </div>

      <!-- Error de especialidades -->
      <div *ngIf="especialidadesSeleccionadas.length === 0 && mostrarErrorEspecialidades" class="error-container">
        <small>Debes seleccionar al menos una especialidad.</small>
      </div>
    </div>

    <!-- Imagen de Perfil -->
    <div class="form-group">
      <label>Imagen de Perfil (1 requerida):</label>
      
      <div class="image-upload-container">
        <label for="imagen1" class="image-upload-label">
          <div class="upload-placeholder" *ngIf="!previewUrl">
            <span>üì∑</span>
            <p>Subir imagen de perfil</p>
          </div>
          <img *ngIf="previewUrl" [src]="previewUrl" alt="Preview" class="image-preview" />
        </label>
        <input id="imagen1" type="file" accept="image/*" 
               (change)="onFileSelected($event)" class="file-input" />
        <button *ngIf="previewUrl" type="button" class="remove-image-btn" 
                (click)="removeImage()">‚úï</button>
      </div>

      <!-- Error de imagen -->
      <div *ngIf="!imagenSeleccionada && mostrarErrorImagen" class="error-container">
        <small>Debes seleccionar una imagen de perfil.</small>
      </div>
    </div>

    <!-- Mensajes de error y √©xito -->
    <div *ngIf="successMessage || errorMessage" class="alert-container">
      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>
      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>
    </div>

    <!-- Bot√≥n de registro -->
    <button type="submit" class="btn btn-primary" [disabled]="isLoading">
      {{ isLoading ? 'Registrando...' : 'Registrar' }}
    </button>

    <!-- Enlaces -->
    <div class="links-container">
      <a routerLink="/login" class="login-link">¬øYa ten√©s una cuenta? Inici√° Sesi√≥n</a>
    </div>
  </form>
</div>